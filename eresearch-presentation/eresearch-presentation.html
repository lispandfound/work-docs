<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Modernising Earthquake Simulation Workflows</title>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/simple.css" id="theme"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<section id="slide-orgd26f84e">
<h2 id="orgd26f84e">Modernising Earthquake Simulation Workflows</h2>
<p>
Jake Faulkner
</p>
<div style="display: grid; grid-template-columns: auto auto auto auto;">

<div id="org516d0bb" class="figure">
<p><img src="coat-of-arms-uc.jpeg" alt="coat-of-arms-uc.jpeg" width="80%" />
</p>
</div>

<div id="org7f07269" class="figure">
<p><img src="QCLogo Standard QC 3 lines 2000ppi.png" alt="QCLogo Standard QC 3 lines 2000ppi.png" width="80%" />
</p>
</div>

<div id="orgd5d3c48" class="figure">
<p><img src="nhc.png" alt="nhc.png" width="80%" />
</p>
</div>

<div id="org6285795" class="figure">
<p><img src="NeSI_Logo_RGB.png" alt="NeSI_Logo_RGB.png" width="80%" />
</p>
</div>
</div>
</section>
</section>
<section>
<section id="slide-orgc6b6756">
<h2 id="orgc6b6756">Context</h2>
<div class="outline-text-2" id="text-orgc6b6756">
</div>
</section>
<section id="slide-org5c116c0">
<h3 id="org5c116c0">What We Do</h3>
<ul>
<li>Support earthquake researchers at UC Civil and Natural Resources Engineering department.</li>
<li>Primary focus: Ground motion simulation software.</li>

</ul>
</section>
<section id="slide-org17e7c9f">
<h3 id="org17e7c9f">Cybershake New Zealand</h3>

<div id="org5f8e21a" class="figure">
<p><img src="cybershake.png" alt="cybershake.png" height="600px" />
</p>
</div>
</section>
<section id="slide-orgb05ce5e">
<h3 id="orgb05ce5e">Researcher Outputs</h3>

<div id="orgaf42488" class="figure">
<p><img src="researcher.png" alt="researcher.png" height="600px" />
</p>
</div>
</section>
<section id="slide-org6c167fd">
<h3 id="org6c167fd">Big Picture</h3>
<dl>
<dt class="fragment fade-in">Cybershake NZ</dt><dd class="fragment fade-in">Better estimates of seismic hazard; inform EQC and disaster response.</dd>
<dt class="fragment fade-in">Researcher outputs</dt><dd class="fragment fade-in">Advance geoscience; improve Cybershake.</dd>

</dl>
</section>
</section>
<section>
<section id="slide-org3a92029">
<h2 id="org3a92029">The Old Simulation Stack</h2>
<div class="outline-text-2" id="text-org3a92029">
</div>
</section>
<section id="slide-org6164dcc">
<h3 id="org6164dcc">Basic Structure</h3>

<div id="orgc6aac32" class="figure">
<p><img src="old_workflow.png" alt="old_workflow.png" />
</p>
</div>
</section>
<section id="slide-org786b425">
<h3 id="org786b425">The Problems</h3>
<ul>
<li class="fragment fade-in">Cybershake-centric, unfriendly to researchers.</li>
<li class="fragment fade-in">Entirely custom solutions for solved problems.</li>
<li class="fragment fade-in">Complex, brittle, hard to reproduce.</li>
<li class="fragment fade-in"><b>So much legacy code!</b></li>

</ul>
</section>
<section>
</section>
<section id="slide-orgf051dbd">
<h3 id="orgf051dbd">Reproducing a Three-Year-Old Simulation</h3>
<ol>
<li class="fragment fade-in">Required our team lead one year,</li>
<li class="fragment fade-in">Involved special tools to re-derive input values,</li>
<li class="fragment fade-in">Ultimately impossible due to changing software.</li>

</ol>

<div id="orgfc24dbb" class="figure">
<p><img src="sung.jpg" alt="sung.jpg" class="fragment (fade-in)" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgacbd8b0">
<h2 id="orgacbd8b0">The New Workflow</h2>
<div class="outline-text-2" id="text-orgacbd8b0">
</div>
</section>
<section id="slide-org8177222">
<h3 id="org8177222">Container + Workflow + Realisation = Simulation</h3>
<ul>
<li><b>Container</b>: Reproducible software stack specification.</li>
<li><b>Workflow</b>: Declarative software execution control.</li>
<li><b>Realisation</b>: Declarative scientific parameter specification.</li>

</ul>
</section>
<section id="slide-org9005552">
<h3 id="org9005552">Containerisation</h3>
<ul>
<li>Apptainer containers for software deployment.</li>
<li>All workflow stages within containers.</li>
<li>Archivable with future Cybershake versions.</li>

</ul>
</section>
<section id="slide-orge164fe5">
<h3 id="orge164fe5">Cylc Workflows</h3>
<div style="float: left; width: 50%">
<ul>
<li class="fragment fade-in">Developed at NIWA.</li>
<li class="fragment fade-in">Supported on HPC by NeSI.</li>
<li class="fragment fade-in"><b>Huge</b> improvement for researcher UX.</li>
<li class="fragment fade-in">Composable for custom workflow.</li>

</ul>
</div>

<div style="float: right; width: 50%">

<div id="orgf405de7" class="figure">
<p><img src="cylc.gif" alt="cylc.gif" />
</p>
</div>
</div>
</section>
<section id="slide-org27e9639">
<h3 id="org27e9639">One-File Simulation Specification</h3>

<div id="orgd4b5b62" class="figure">
<p><img src="config.png" alt="config.png" />
</p>
</div>
</section>
<section>
<div class="org-src-container">

<pre class="src src-bash">realisation.json
      &#9488;
      &#9500;&#9472;&#9472; metadata
      &#9474;   &#9500;&#9472;&#9472; name: <span style="color: #da8548; font-weight: bold;">3468575</span>
      &#9474;   &#9500;&#9472;&#9472; version: <span style="color: #da8548; font-weight: bold;">1</span>
      &#9474;   &#9500;&#9472;&#9472; defaults_version: 24.2.2.2
      &#9474;   &#9492;&#9472;&#9472; tag: gcmt
      &#9500;&#9472;&#9472; sources
      &#9474;   &#9492;&#9472;&#9472; source_geometries <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
      &#9500;&#9472;&#9472; rupture_propagation
      &#9474;   &#9500;&#9472;&#9472; rupture_causality_tree <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
      &#9474;   &#9500;&#9472;&#9472; jump_points
      &#9474;   &#9500;&#9472;&#9472; rakes <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
      &#9474;   &#9500;&#9472;&#9472; magnitudes <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
      &#9474;   &#9492;&#9472;&#9472; hypocentre <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
      &#9500;&#9472;&#9472; srf
      &#9474;   &#9500;&#9472;&#9472; genslip_dt: <span style="color: #da8548; font-weight: bold;">0.05</span>
      &#9474;   &#9500;&#9472;&#9472; genslip_version: 5.4.2
      &#9474;   &#9492;&#9472;&#9472; resolution: <span style="color: #da8548; font-weight: bold;">0.2</span>
      &#9500;&#9472;&#9472; seeds
      &#9474;   &#9500;&#9472;&#9472; nshm_to_realisation_seed: <span style="color: #da8548; font-weight: bold;">554010839</span>
      &#9474;   &#9500;&#9472;&#9472; rupture_propagation_seed: <span style="color: #da8548; font-weight: bold;">1355831879</span>
      &#9474;   &#9500;&#9472;&#9472; genslip_seed: <span style="color: #da8548; font-weight: bold;">906043042</span>
      <span style="color: #51afef;">[</span>...<span style="color: #51afef;">]</span>
</pre>
</div>
</section>
<section id="slide-orgc08813e">
<h3 id="orgc08813e">Workflow Planner</h3>
<ul>
<li>Workflow stages that compose together enables a flexible workflow planning tool.</li>
<li>Skip or set a goal for any stage to generate custom research workflows!</li>

</ul>
<div style="font-size: 60%;">
<div class="org-src-container">

<pre class="src src-bash">  $ plan-workflow 2024p910344 flow.cylc --source gcmt --goal im_calc <span style="color: #98be65;">\</span>
      --excluding realisation_to_srf --archiving hf_sim
  You require the following files for your simulation:
  &#9488;
  &#9492;&#9472;&#9472; cylc-src
      &#9492;&#9472;&#9472; WORKFLOW_NAME
          &#9492;&#9472;&#9472; input
              &#9500;&#9472;&#9472; 2024p910344
              &#9474;   &#9500;&#9472;&#9472; realisation.json
              &#9474;   &#9474;   &#9492;&#9472;&#9472; srf: Configuration for SRF generation.
              &#9474;   &#9492;&#9472;&#9472; realisation.srf: Contains the slip model for the realisation.
              ...
</pre>
</div>
</div>
</section>
<section>

<div id="orgb05779f" class="figure">
<p><img src="graph.png" alt="graph.png" height="600px" />
</p>
</div>
</section>
<section id="slide-orge6f8e7b">
<h3 id="orge6f8e7b">Hypothesis Testing</h3>
<ul>
<li>Used to test thousands of examples for critical scientific code.</li>
<li>Potentially saves hundreds of thousands of wasted core-hours.</li>

</ul>
</section>
<section>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ECBE7B;">@given</span>(st.integers(<span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">50</span>))
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_prime_formula</span>(n: <span style="color: #c678dd;">int</span>):
    <span style="color: #83898d;">"""Test Euler's formula for primes."""</span>
    <span style="color: #51afef;">assert</span> is_prime(n**<span style="color: #da8548; font-weight: bold;">2</span> + n + <span style="color: #da8548; font-weight: bold;">41</span>)
</pre>
</div>
</section>
<section>
<pre class="example" id="org5bc040d">
n = 40

    @given(st.integers(0, 50))
    def test_prime_formula(n: int):
&gt;       assert is_prime(n**2 + n + 41)
E       assert False
</pre>
</section>
</section>
<section>
<section id="slide-org3d1e087">
<h2 id="org3d1e087">Key Takeaways</h2>
<ul>
<li class="fragment fade-in">Make your workflows <b>declarative</b>.</li>
<li class="fragment fade-in">Make your workflows <b>composable</b>.</li>
<li class="fragment fade-in">Automate your testing.</li>
<li class="fragment fade-in">Design for the <b>least-savvy user</b>.</li>

</ul>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/search/search.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom/zoom.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,

transition: 'convex',
transitionSpeed: 'default',

// Plugins with reveal.js 4.x
plugins: [ RevealMarkdown, RevealNotes, RevealSearch, RevealZoom ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
